
Table "users" {
  "id" INT [pk, not null, increment]
  "phone" VARCHAR(20) [unique]
  "email" VARCHAR(255) [unique]
  "password_hash" TEXT [not null]
  "full_name" VARCHAR(255)
  "role" VARCHAR(20) [default: 'passenger']
  "is_verified" BOOLEAN [default: false]
  "created_at" TIMESTAMP [default: `now()`]
  "updated_at" TIMESTAMP [default: `now()`]
}

Table "operators" {
  "id" INT [pk, not null, increment]
  "user_id" BIGINT [not null]
  "name" VARCHAR(255) [not null]
  "license_number" VARCHAR(100) [unique]
  "verified" BOOLEAN [default: false]
  "contact_info" INT
  "created_at" TIMESTAMP [default: `now()`]
}

Table "drivers" {
  "id" INT [pk, not null, increment]
  "operator_id" BIGINT [not null]
  "full_name" VARCHAR(255) [not null]
  "phone" VARCHAR(20) [unique, not null]
  "license_number" VARCHAR(100) [unique, not null]
  "status" VARCHAR(20) [default: 'active']
  "created_at" TIMESTAMP [default: `now()`]
}

Table "routes" {
  "id" INT [pk, not null, increment]
  "origin" VARCHAR(255) [not null]
  "destination" VARCHAR(255) [not null]
  "distance_km" INT
  "approx_duration" VARCHAR
  "created_at" TIMESTAMP [default: `now()`]
}

Table "buses" {
  "id" INT [pk, not null, increment]
  "operator_id" BIGINT [not null]
  "registration_number" VARCHAR(50) [unique, not null]
  "model" VARCHAR(100)
  "seat_layout" INT [not null]
  "total_seats" INT [not null]
  "amenities" INT
  "created_at" TIMESTAMP [default: `now()`]
}

Table "trips" {
  "id" INT [pk, not null, increment]
  "bus_id" BIGINT [not null]
  "route_id" BIGINT [not null]
  "driver_id" BIGINT
  "departure_time" TIMESTAMP [not null]
  "arrival_time" TIMESTAMP
  "base_fare" NUMERIC(10,2) [not null]
  "status" VARCHAR(20) [default: 'scheduled']
  "created_at" TIMESTAMP [default: `now()`]
  "updated_at" TIMESTAMP [default: `now()`]
}

Table "bookings" {
  "id" INT [pk, not null, increment]
  "user_id" BIGINT [not null]
  "trip_id" BIGINT [not null]
  "total_amount" NUMERIC(10,2) [not null]
  "status" VARCHAR(20) [default: 'pending']
  "payment_id" BIGINT
  "created_at" TIMESTAMP [default: `now()`]
  "updated_at" TIMESTAMP [default: `now()`]
}

Table "booking_seats" {
  "id" INT [pk, not null, increment]
  "booking_id" BIGINT [not null]
  "seat_id" VARCHAR(50) [not null]
  "price" NUMERIC(10,2) [not null]
  "status" VARCHAR(20) [default: 'reserved']
}

Table "payments" {
  "id" INT [pk, not null, increment]
  "booking_id" BIGINT [not null]
  "provider" VARCHAR(50) [not null]
  "provider_payment_id" VARCHAR(255)
  "amount" NUMERIC(10,2) [not null]
  "currency" VARCHAR(10) [default: 'BDT']
  "status" VARCHAR(20) [not null]
  "created_at" TIMESTAMP [default: `now()`]
}

Table "coupons" {
  "id" INT [pk, not null, increment]
  "code" VARCHAR(50) [unique, not null]
  "description" TEXT
  "discount_type" VARCHAR(20) [not null]
  "discount_value" NUMERIC(10,2) [not null]
  "valid_from" TIMESTAMP
  "valid_to" TIMESTAMP
  "usage_limit" INT
  "used_count" INT [default: 0]
  "created_at" TIMESTAMP [default: `now()`]
}

Table "loyalty_points" {
  "id" INT [pk, not null, increment]
  "user_id" BIGINT [not null]
  "points" INT [default: 0]
  "last_updated" TIMESTAMP [default: `now()`]
}

Table "audit_logs" {
  "id" INT [pk, not null, increment]
  "user_id" BIGINT
  "action" VARCHAR(255) [not null]
  "details" INT
  "created_at" TIMESTAMP [default: `now()`]
}

Table "feedbacks" {
  "id" INT [pk, not null, increment]
  "user_id" BIGINT
  "trip_id" BIGINT
  "rating" INT
  "comment" TEXT
  "created_at" TIMESTAMP [default: `now()`]
}

Table "notifications" {
  "id" INT [pk, not null, increment]
  "user_id" BIGINT
  "message" TEXT [not null]
  "read_status" BOOLEAN [default: false]
  "created_at" TIMESTAMP [default: `now()`]
}

Ref:"users"."id" < "operators"."user_id" [update: cascade, delete: cascade]

Ref:"operators"."id" < "drivers"."operator_id" [update: cascade, delete: cascade]

Ref:"operators"."id" < "buses"."operator_id" [update: cascade, delete: cascade]

Ref:"buses"."id" < "trips"."bus_id" [update: cascade, delete: cascade]

Ref:"routes"."id" < "trips"."route_id" [update: cascade, delete: cascade]

Ref:"drivers"."id" < "trips"."driver_id" [update: cascade, delete: set null]

Ref:"users"."id" < "bookings"."user_id" [update: cascade, delete: cascade]

Ref:"trips"."id" < "bookings"."trip_id" [update: cascade, delete: cascade]

Ref:"payments"."id" < "bookings"."payment_id" [update: cascade, delete: set null]

Ref:"bookings"."id" < "booking_seats"."booking_id" [update: cascade, delete: cascade]

Ref:"bookings"."id" < "payments"."booking_id" [update: cascade, delete: cascade]

Ref:"users"."id" < "loyalty_points"."user_id" [update: cascade, delete: cascade]

Ref:"users"."id" < "audit_logs"."user_id" [update: cascade, delete: set null]

Ref:"users"."id" < "feedbacks"."user_id" [update: cascade, delete: cascade]

Ref:"trips"."id" < "feedbacks"."trip_id" [update: cascade, delete: cascade]

Ref:"users"."id" < "notifications"."user_id" [update: cascade, delete: cascade]
